<article class="product-card" [class]="'card-' + cardSize" (click)="viewProduct()">
  <!-- Product Image -->
  <div class="product-image-container">
    <img 
      [src]="getCurrentProductImage()" 
      [alt]="product.name"
      class="product-image"
      (error)="onImageError($event)"
      loading="lazy"
    />
    
    <!-- Discount Badge -->
    <div *ngIf="hasDiscount()" class="discount-badge">
      -{{ getDiscountPercentage() }}%
    </div>
    
    <!-- Stock Badge -->
    <div *ngIf="isOutOfStock()" class="stock-badge out-of-stock">
      Sin Stock
    </div>
    <div *ngIf="!isOutOfStock() && (product.quantity || 0) <= 3" class="stock-badge low-stock">
      Ãšltimas {{ product.quantity }}
    </div>
    
    <!-- Favorite Button -->
    <button 
      class="favorite-btn"
      [class.is-favorite]="isFavorite"
      [disabled]="favoriteLoading"
      (click)="toggleFavorite($event)"
      title="Agregar a favoritos"
    >
      <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
      </svg>
    </button>
  </div>

  <!-- Product Info -->
  <div class="product-info">
    <!-- Product Header -->
    <div class="product-header">
      <h3 class="product-name">{{ product.name }}</h3>
      <p class="product-code">{{ product.code }}</p>
    </div>

    <!-- Product Price -->
    <div class="product-pricing">
      <span class="current-price">${{ product.price }}</span>
      <span *ngIf="hasDiscount()" class="original-price">${{ product.publicPrice }}</span>
    </div>

    <!-- Product Category -->
    <div *ngIf="product.category" class="product-category">
      {{ product.category }}
    </div>

    <!-- ðŸ”¥ NUEVA SECCIÃ“N: Color Selection -->
    <div *ngIf="availableColors.length > 0" class="color-selection">
      <div class="color-options">
        <button 
          *ngFor="let color of availableColors.slice(0, 4)" 
          class="color-btn"
          [class.selected]="selectedColor === color.name"
          [style.background-color]="color.hex"
          (click)="selectColor(color.name, color.hex, $event)"
          [title]="color.name"
        >
        </button>
        <span *ngIf="availableColors.length > 4" class="more-colors">
          +{{ availableColors.length - 4 }}
        </span>
      </div>
    </div>

    <!-- ðŸ”¥ ACTUALIZADA: Size Selection -->
    <div *ngIf="showSizes && allAvailableSizes.length > 0" class="size-selection">
      <div class="size-options">
        <button 
          *ngFor="let size of allAvailableSizes.slice(0, 3)" 
          class="size-btn"
          [class.selected]="selectedSize === size.toString()"
          (click)="selectSize(size, $event)"
        >
          {{ size }}
        </button>
        <span *ngIf="allAvailableSizes.length > 3" class="more-sizes">
          +{{ allAvailableSizes.length - 3 }}
        </span>
      </div>
    </div>

    <!-- Add to Cart Button -->
    <button 
      *ngIf="showAddToCart && !isOutOfStock()"
      class="add-to-cart-btn"
      [disabled]="cartLoading"
      (click)="addToCart($event)"
    >
      <svg *ngIf="!cartLoading" width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
        <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
        <path d="M9 8V17H11V8H9ZM13 8V17H15V8H13Z"/>
      </svg>
      <div *ngIf="cartLoading" class="loading-spinner"></div>
      {{ cartLoading ? 'Agregando...' : 'AÃ±adir al carrito' }}
    </button>

    <!-- Out of Stock Button -->
    <button *ngIf="isOutOfStock()" class="out-of-stock-btn" disabled>
      Sin Stock
    </button>
  </div>
</article>
